<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Book a Ride ‚Äî RapidRide</title>
  <link rel="stylesheet" href="../common/css/global.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    /* Booking Split Layout */
    .booking-layout {
      display: grid;
      grid-template-columns: 400px 1fr;
      min-height: calc(100vh - 80px);
      /* Minus header */
    }

    @media (max-width: 900px) {
      .booking-layout {
        grid-template-columns: 1fr;
        grid-template-rows: auto 1fr;
        height: auto;
      }
    }

    /* Left Panel: Controls */
    .booking-controls {
      background: var(--bg-sand);
      padding: 2rem;
      border-right: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      z-index: 10;
    }

    /* Right Panel: Map */
    .booking-map {
      width: 100%;
      height: 100%;
      min-height: 400px;
      background: #e5e5e5;
    }

    #map {
      width: 100%;
      height: 100%;
      min-height: 400px;
    }

    /* Input Dots */
    .location-input-group {
      position: relative;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .connector-line {
      position: absolute;
      left: 19px;
      top: 40px;
      bottom: -20px;
      width: 2px;
      background: #e5e5e5;
      z-index: 0;
    }

    .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      flex-shrink: 0;
      z-index: 1;
    }

    .dot-pickup {
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1);
    }

    .dot-drop {
      background: #ef4444;
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
    }

    /* Vehicle Grid */
    .vehicle-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1rem;
    }

    .vehicle-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.25rem;
      border: 1px solid var(--glass-border);
      border-radius: var(--radius-md);
      background: white;
      cursor: pointer;
      transition: 0.2s;
    }

    .vehicle-option:hover {
      border-color: var(--primary);
      transform: scale(1.01);
      box-shadow: var(--glass-shadow);
    }

    .vehicle-option.selected {
      border-color: var(--primary);
      background: #1c191708;
      /* Very subtle dark tint */
      box-shadow: 0 0 0 2px var(--primary);
    }

    .vehicle-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .vehicle-emoji {
      font-size: 2rem;
    }

    .price-tag {
      font-weight: 700;
      font-size: 1.1rem;
    }
  </style>
  <script src="../common/js/config.js"></script>
</head>

<body>

  <!-- Navbar (Consistent) -->
  <nav class="navbar">
    <div style="display: flex; align-items: center; gap: 1rem; cursor: pointer;"
      onclick="window.location.href='rider_home.html'">
      <div class="btn-secondary"
        style="width: 40px; height: 40px; padding: 0; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 1px solid #e5e5e5;">
        ‚Üê
      </div>
      <span style="font-weight: 800; font-size: 1.1rem;">Plan your ride</span>
    </div>

    <!-- Optional: Profile or Help -->
    <div style="font-size: 0.9rem; font-weight: 600; color: var(--text-secondary);">Help</div>
  </nav>

  <div class="booking-layout">

    <!-- Controls Panel -->
    <div class="booking-controls fade-in">

      <!-- Route Inputs -->
      <div class="glass-card" style="padding: 1.5rem; background: white; border: 1px solid var(--glass-border);">
        <div class="location-input-group" style="margin-bottom: 1.5rem;">
          <div class="dot dot-pickup"></div>
          <div style="flex:1;">
            <label style="font-size: 0.85rem; margin-bottom: 0.25rem;">Pickup Location</label>
            <input type="text" id="pickupInput" class="input-field" placeholder="Search pickup...">
          </div>
          <div class="connector-line"></div>
        </div>

        <div class="location-input-group">
          <div class="dot dot-drop"></div>
          <div style="flex:1;">
            <label style="font-size: 0.85rem; margin-bottom: 0.25rem;">Drop Location</label>
            <input type="text" id="dropInput" class="input-field" placeholder="Where to?">
          </div>
        </div>
      </div>

      <!-- Vehicle Selection (Hidden initially) -->
      <div id="vehicleSection" style="display: none;" class="slide-up">
        <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">Select Ride</h3>
        <div class="vehicle-grid" id="vehicleGrid">
          <!-- JS Injected Params -->
        </div>
      </div>

      <!-- Action Button -->
      <div style="margin-top: auto;">
        <button id="bookRideBtn" class="btn btn-primary w-full" disabled onclick="requestRide()">
          Confirm Booking
        </button>
      </div>

    </div>

    <!-- Map Panel -->
    <div class="booking-map">
      <div id="map"></div>
    </div>

  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

  <!-- Location Autocomplete (Re-using existing logic) -->
  <script src="../common/js/location-autocomplete.js"></script>

  <script>
    // Initialize Map
    const map = L.map('map', { zoomControl: false }).setView([17.3850, 78.4867], 13);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap &copy; CARTO'
    }).addTo(map);

    // --- Simple Frontend Logic to mimic existing book_ride.html but with new UI ---
    // (Simplified for visual update - logic hooks can be re-connected)

    const VEHICLES = [
      { type: 'bike', name: 'Rapid Bike', icon: 'üèçÔ∏è', baseRate: 20, perKm: 5, capacity: 1 },
      { type: 'auto', name: 'Auto', icon: 'üõ∫', baseRate: 30, perKm: 10, capacity: 3 },
      { type: 'car', name: 'Mini Cab', icon: 'üöó', baseRate: 50, perKm: 12, capacity: 4 },
      { type: 'suv', name: 'Prime SUV', icon: 'üöô', baseRate: 80, perKm: 18, capacity: 6 },
    ];

    // Re-implement showVehicles to populate new grid
    // (This function will be called by autocomplete logic)
    function showVehicles(distance) {
      const grid = document.getElementById('vehicleGrid');
      document.getElementById('vehicleSection').style.display = 'block';

      grid.innerHTML = VEHICLES.map(v => {
        // Static calc for demo (ML integration hooks here)
        const price = Math.round(v.baseRate + (distance * v.perKm));
        return `
                <div class="vehicle-option" onclick="selectVehicle(this, '${v.type}', ${price})">
                    <div class="vehicle-left">
                        <span class="vehicle-emoji">${v.icon}</span>
                        <div>
                            <div style="font-weight: 700;">${v.name}</div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">2 mins away ‚Ä¢ ${v.capacity} seats</div>
                        </div>
                    </div>
                    <div class="price-tag">‚Çπ${price}</div>
                </div>
              `;
      }).join('');
    }

    function selectVehicle(el, type, price) {
      document.querySelectorAll('.vehicle-option').forEach(d => d.classList.remove('selected'));
      el.classList.add('selected');

      const btn = document.getElementById('bookRideBtn');
      btn.disabled = false;
      btn.innerHTML = `Book ${type.toUpperCase()} - ‚Çπ${price}`;
    }

    // Auto-focus pickup
    document.getElementById('pickupInput').focus();
  </script>
</body>

</html>
